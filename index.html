<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Autoplay Live Stream – CriccSojeeb</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.js"></script>

<style>
body{
  margin:0;
  background:#050b18;
  font-family:Arial, sans-serif;
  color:#fff;
}
.wrapper{
  max-width:900px;
  margin:auto;
  padding:12px;
}
.header{
  background:#0a1f44;
  padding:14px;
  text-align:center;
  font-size:20px;
  font-weight:bold;
  border-radius:12px;
}
.player-box{
  margin-top:12px;
  width:100%;
  aspect-ratio:16/9;
  background:#000;
  border-radius:12px;
  overflow:hidden;
}
.player-box video{
  width:100%;
  height:100%;
}
.note{
  margin-top:10px;
  font-size:13px;
  opacity:.8;
  text-align:center;
}
</style>
</head>

<body>

<div class="wrapper">

  <div class="header">Live Stream – CriccSojeeb</div>

  <div class="player-box">
    <video id="player" playsinline muted autoplay controls preload="auto"></video>
  </div>

  <div class="note">
    ⚠️ Autoplay works muted. Tap to enable sound. Quality auto-adjusts based on network.
  </div>

</div>

<script>
const STREAM_URL = "https://allinonereborn.xyz/mix.m3u8/live4.php?id=968928";
const video = document.getElementById("player");

function startPlayer(){
  if(Hls.isSupported()){
    const hls = new Hls({
      autoStartLoad: true,
      startPosition: -1,        // Latest live segment থেকে শুরু
      maxBufferLength: 10,      // buffer কমিয়ে fast start
      maxMaxBufferLength: 30,
      liveSyncDuration: 1.5,
      capLevelToPlayerSize: true, // resolution auto adjust
      // adaptive bitrate
      defaultAudioCodec: undefined
    });

    hls.loadSource(STREAM_URL);
    hls.attachMedia(video);

    // when manifest loaded, start play
    hls.on(Hls.Events.MANIFEST_PARSED, function(event, data){
      // Add quality levels to Plyr
      const availableQualities = hls.levels.map((l) => l.height).sort((a,b)=>b-a);
      const player = new Plyr(video, {
        fullscreen:{enabled:true},
        settings:['quality','speed','fullscreen'],
        quality:{
          default:availableQualities[0],
          options:availableQualities,
          forced:true,
          onChange: e => changeQuality(e)
        }
      });

      // autoplay
      video.play().catch(err => console.log("Autoplay blocked:", err));

      // change quality function
      function changeQuality(newQuality){
        const levelIndex = hls.levels.findIndex(l => l.height === newQuality);
        hls.currentLevel = levelIndex;
      }
    });

    // adaptive quality
    hls.on(Hls.Events.LEVEL_SWITCHED, function(event, data){
      console.log("Switched to level:", data.level, "Resolution:", hls.levels[data.level].height);
    });

  }else{
    // fallback
    video.src = STREAM_URL;
    video.play().catch(err => console.log("Autoplay blocked:", err));
    new Plyr(video,{
      fullscreen:{enabled:true},
      settings:['quality','speed','fullscreen']
    });
  }
}

// start the player
startPlayer();

// tap করলে sound চালু হবে
video.addEventListener("click", ()=>{
  video.muted = false;
});
</script>

</body>
</html>
