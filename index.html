<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Low-Latency Live Stream – CriccSojeeb</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.js"></script>

<style>
body{
  margin:0;
  background:#050b18;
  font-family:Arial, sans-serif;
  color:#fff;
}
.wrapper{
  max-width:900px;
  margin:auto;
  padding:12px;
}
.header{
  background:#0a1f44;
  padding:14px;
  text-align:center;
  font-size:20px;
  font-weight:bold;
  border-radius:12px;
}
.player-box{
  margin-top:12px;
  width:100%;
  aspect-ratio:16/9;
  background:#000;
  border-radius:12px;
  overflow:hidden;
}
.player-box video{
  width:100%;
  height:100%;
}
.note{
  margin-top:10px;
  font-size:13px;
  opacity:.8;
  text-align:center;
}
</style>
</head>

<body>

<div class="wrapper">

  <div class="header">Low-Latency Live Stream</div>

  <div class="player-box">
    <video id="player" playsinline muted autoplay controls preload="auto"></video>
  </div>

  <div class="note">
    ⚠️ Autoplay muted. Tap to enable sound. Quality adjusts based on network. Low-latency live.
  </div>

</div>

<script>
const STREAM_URL = "https://allinonereborn.xyz/mix.m3u8/live4.php?id=968928";
const video = document.getElementById("player");

function startPlayer(){
  if(Hls.isSupported()){
    const hls = new Hls({
      autoStartLoad: true,
      startPosition: -1,           // latest live segment থেকে start
      maxBufferLength: 3,          // small buffer → fast start
      maxMaxBufferLength: 6,
      liveSyncDuration: 0.5,       // low latency
      liveMaxLatencyDuration: 2,   // max 2 seconds delay
      enableWorker: true,
      backBufferLength: 0,         // old segments remove
      capLevelToPlayerSize: true,  // resolution auto adjust
      defaultAudioCodec: undefined
    });

    hls.loadSource(STREAM_URL);
    hls.attachMedia(video);

    hls.on(Hls.Events.MANIFEST_PARSED, function(){
      // Quality options
      const availableQualities = hls.levels.map(l => l.height).sort((a,b)=>b-a);
      const player = new Plyr(video,{
        fullscreen:{enabled:true},
        settings:['quality','speed','fullscreen'],
        quality:{
          default:availableQualities[0],
          options:availableQualities,
          forced:true,
          onChange: e => {
            const levelIndex = hls.levels.findIndex(l => l.height === e);
            hls.currentLevel = levelIndex;
          }
        }
      });

      // autoplay
      video.play().catch(err => console.log("Autoplay blocked:", err));
    });

    // log level switch for debugging
    hls.on(Hls.Events.LEVEL_SWITCHED, function(event,data){
      console.log("Switched to level:", data.level, "Resolution:", hls.levels[data.level].height);
    });

  }else{
    video.src = STREAM_URL;
    video.play().catch(err => console.log("Autoplay blocked:", err));
    new Plyr(video,{
      fullscreen:{enabled:true},
      settings:['quality','speed','fullscreen']
    });
  }
}

// start player
startPlayer();

// tap করলে sound চালু হবে
video.addEventListener("click", ()=>{
  video.muted = false;
});
</script>

</body>
</html>
